var http = require("http");
var url = require("url");
var qs = require("querystring");
var items = [];

function start(route, handle) {
	http
		.createServer(function(req, res) {
			var pathname = url.parse(req.url).pathname;
			//var route_html = route(pathname, handle);
			switch (req.method) {
				case "GET" :
					show(res);
					break;
				case "POST" :
					add(req, res);
					break;
				default:
					res.statusCode = 404;
					res.end("404");
			}
		})
		.listen(2015);
}

function show(res) {
	var html = "<html><head><title></title></head><body>"
			 + "<h1>Todo List</h1>"
			 + "<ul>"
			 + items.map(function(item) {
			 	return "<li>" + item + "</li>"
			 }).join("")
			 + "</ul><form method=\"post\" action=\"/\">"
			 + "<p><input type=\"text\" name=\"item\" /></p>"
			 + "<p><input type=\"submit\" value=\"Add Item\" /></p>"
			 +"</form></body></html>";
	res.setHeader("Content-Type", "text/html");
	res.end(html);
}

function add(req, res) {
	var body = "";
	//req.setEncoding("utf8");
	req.on("data", function(buf) {
		body += buf;
	});
	req.on("end", function() {
		var obj = qs.parse(body);
		console.log(body);
		items.push(obj.item);
		show(res);
	})
}

exports.start = start;